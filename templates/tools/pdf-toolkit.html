{% extends "base.html" %}

{% block title %}PDF Toolkit - DiskTools{% endblock %}

{% block content %}
<div class="container mx-auto px-6 py-12">
    <!-- Header -->
    <div class="text-center mb-12">
        <div class="inline-block p-4 bg-gradient-to-r from-primary to-secondary rounded-full mb-6">
            <i class="fas fa-file-pdf text-4xl text-white"></i>
        </div>
        <h1 class="text-4xl font-bold mb-4 text-gradient">PDF Toolkit</h1>
        <p class="text-xl text-gray-300">Merge, split, compress, and convert PDFs with ease</p>
    </div>

    <!-- PDF Tools -->
    <div class="max-w-6xl mx-auto">
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
            <!-- Merge PDFs -->
            <div class="tool-option glass rounded-2xl p-6 cursor-pointer hover-lift" data-tool="merge">
                <div class="text-center">
                    <i class="fas fa-layer-group text-4xl text-primary mb-4"></i>
                    <h3 class="text-xl font-bold mb-2">Merge PDFs</h3>
                    <p class="text-gray-400">Combine multiple PDF files into one</p>
                </div>
            </div>
            
            <!-- Split PDF -->
            <div class="tool-option glass rounded-2xl p-6 cursor-pointer hover-lift" data-tool="split">
                <div class="text-center">
                    <i class="fas fa-cut text-4xl text-secondary mb-4"></i>
                    <h3 class="text-xl font-bold mb-2">Split PDF</h3>
                    <p class="text-gray-400">Extract pages from PDF files</p>
                </div>
            </div>
            
            <!-- Compress PDF -->
            <div class="tool-option glass rounded-2xl p-6 cursor-pointer hover-lift" data-tool="compress">
                <div class="text-center">
                    <i class="fas fa-compress-alt text-4xl text-accent mb-4"></i>
                    <h3 class="text-xl font-bold mb-2">Compress PDF</h3>
                    <p class="text-gray-400">Reduce PDF file size</p>
                </div>
            </div>
            
            <!-- Convert to PDF -->
            <div class="tool-option glass rounded-2xl p-6 cursor-pointer hover-lift" data-tool="convert">
                <div class="text-center">
                    <i class="fas fa-exchange-alt text-4xl text-primary mb-4"></i>
                    <h3 class="text-xl font-bold mb-2">Convert to PDF</h3>
                    <p class="text-gray-400">Convert images and documents to PDF</p>
                </div>
            </div>
            
            <!-- Add Watermark -->
            <div class="tool-option glass rounded-2xl p-6 cursor-pointer hover-lift" data-tool="watermark">
                <div class="text-center">
                    <i class="fas fa-stamp text-4xl text-secondary mb-4"></i>
                    <h3 class="text-xl font-bold mb-2">Add Watermark</h3>
                    <p class="text-gray-400">Add text or image watermarks</p>
                </div>
            </div>
            
            <!-- Extract Text -->
            <div class="tool-option glass rounded-2xl p-6 cursor-pointer hover-lift" data-tool="extract">
                <div class="text-center">
                    <i class="fas fa-file-alt text-4xl text-accent mb-4"></i>
                    <h3 class="text-xl font-bold mb-2">Extract Text</h3>
                    <p class="text-gray-400">Extract text content from PDFs</p>
                </div>
            </div>
        </div>
        
        <!-- Tool Interface -->
        <div id="toolInterface" class="glass rounded-2xl p-8 hidden">
            <div class="flex justify-between items-center mb-6">
                <h2 id="toolTitle" class="text-2xl font-bold">Select a Tool</h2>
                <button id="backToTools" class="btn-secondary">
                    <i class="fas fa-arrow-left mr-2"></i>
                    Back to Tools
                </button>
            </div>
            
            <!-- File Upload Area -->
            <div id="uploadArea" class="border-2 border-dashed border-white/20 rounded-xl p-8 text-center mb-6">
                <i class="fas fa-cloud-upload-alt text-4xl text-gray-400 mb-4"></i>
                <p class="text-lg text-gray-300 mb-2">Drop PDF files here or click to browse</p>
                <p class="text-sm text-gray-500">Supports PDF files up to 10MB each</p>
                <input type="file" id="fileInput" multiple accept=".pdf" class="hidden">
                <button id="browseFiles" class="btn-primary mt-4">
                    <i class="fas fa-folder-open mr-2"></i>
                    Browse Files
                </button>
            </div>
            
            <!-- File List -->
            <div id="fileList" class="mb-6 hidden">
                <h3 class="text-lg font-bold mb-4">Selected Files</h3>
                <div id="filesContainer" class="space-y-2">
                    <!-- Files will be listed here -->
                </div>
            </div>
            
            <!-- Tool Options -->
            <div id="toolOptions" class="mb-6 hidden">
                <!-- Tool-specific options will be shown here -->
            </div>
            
            <!-- Process Button -->
            <div id="processSection" class="text-center hidden">
                <button id="processFiles" class="btn-primary px-8 py-3 text-lg">
                    <i class="fas fa-cog mr-2"></i>
                    Process Files
                </button>
            </div>
            
            <!-- Results -->
            <div id="resultsSection" class="hidden">
                <h3 class="text-lg font-bold mb-4">Results</h3>
                <div id="resultsContainer">
                    <!-- Results will be shown here -->
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
class PDFToolkit {
    constructor() {
        this.currentTool = null;
        this.selectedFiles = [];
        this.init();
    }

    init() {
        this.setupEventListeners();
    }

    setupEventListeners() {
        // Tool selection
        document.querySelectorAll('.tool-option').forEach(option => {
            option.addEventListener('click', (e) => {
                const tool = e.currentTarget.dataset.tool;
                this.selectTool(tool);
            });
        });

        // File handling
        document.getElementById('browseFiles').addEventListener('click', () => {
            document.getElementById('fileInput').click();
        });

        document.getElementById('fileInput').addEventListener('change', (e) => {
            this.handleFileSelect(e.target.files);
        });

        // Drag and drop
        const uploadArea = document.getElementById('uploadArea');
        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.classList.add('border-primary');
        });

        uploadArea.addEventListener('dragleave', () => {
            uploadArea.classList.remove('border-primary');
        });

        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('border-primary');
            this.handleFileSelect(e.dataTransfer.files);
        });

        // Back button
        document.getElementById('backToTools').addEventListener('click', () => {
            this.showToolSelection();
        });

        // Process button
        document.getElementById('processFiles').addEventListener('click', () => {
            this.processFiles();
        });
    }

    selectTool(tool) {
        this.currentTool = tool;
        this.showToolInterface();
        this.updateToolInterface();
    }

    showToolSelection() {
        document.getElementById('toolInterface').classList.add('hidden');
        this.currentTool = null;
        this.selectedFiles = [];
    }

    showToolInterface() {
        document.getElementById('toolInterface').classList.remove('hidden');
    }

    updateToolInterface() {
        const titles = {
            merge: 'Merge PDFs',
            split: 'Split PDF',
            compress: 'Compress PDF',
            convert: 'Convert to PDF',
            watermark: 'Add Watermark',
            extract: 'Extract Text'
        };

        document.getElementById('toolTitle').textContent = titles[this.currentTool];
        
        // Update upload area text based on tool
        const uploadTexts = {
            merge: 'Drop multiple PDF files to merge',
            split: 'Drop a PDF file to split',
            compress: 'Drop PDF files to compress',
            convert: 'Drop images or documents to convert',
            watermark: 'Drop PDF files to add watermark',
            extract: 'Drop PDF files to extract text'
        };

        document.querySelector('#uploadArea p').textContent = uploadTexts[this.currentTool];
        
        // Update file input accept attribute
        const acceptTypes = {
            merge: '.pdf',
            split: '.pdf',
            compress: '.pdf',
            convert: '.jpg,.jpeg,.png,.gif,.bmp,.doc,.docx,.txt',
            watermark: '.pdf',
            extract: '.pdf'
        };

        document.getElementById('fileInput').accept = acceptTypes[this.currentTool];
    }

    handleFileSelect(files) {
        this.selectedFiles = Array.from(files);
        this.displayFileList();
        this.showToolOptions();
    }

    displayFileList() {
        const container = document.getElementById('filesContainer');
        const fileList = document.getElementById('fileList');

        if (this.selectedFiles.length === 0) {
            fileList.classList.add('hidden');
            return;
        }

        fileList.classList.remove('hidden');
        
        container.innerHTML = this.selectedFiles.map((file, index) => `
            <div class="flex items-center justify-between p-3 bg-dark/30 rounded-lg">
                <div class="flex items-center space-x-3">
                    <i class="fas fa-file-pdf text-red-400"></i>
                    <div>
                        <div class="font-semibold text-white">${file.name}</div>
                        <div class="text-sm text-gray-400">${this.formatFileSize(file.size)}</div>
                    </div>
                </div>
                <button onclick="removeFile(${index})" class="text-red-400 hover:text-red-300">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        `).join('');
    }

    showToolOptions() {
        const optionsContainer = document.getElementById('toolOptions');
        const processSection = document.getElementById('processSection');
        
        optionsContainer.classList.remove('hidden');
        processSection.classList.remove('hidden');
        
        // Show tool-specific options
        optionsContainer.innerHTML = this.getToolOptions();
    }

    getToolOptions() {
        switch (this.currentTool) {
            case 'merge':
                return `
                    <h3 class="text-lg font-bold mb-4">Merge Options</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm text-gray-300 mb-2">Output filename</label>
                            <input type="text" id="outputName" value="merged-document.pdf" class="input-field">
                        </div>
                        <div>
                            <label class="block text-sm text-gray-300 mb-2">Page order</label>
                            <select id="pageOrder" class="input-field">
                                <option value="original">Keep original order</option>
                                <option value="reverse">Reverse order</option>
                                <option value="alphabetical">Alphabetical by filename</option>
                            </select>
                        </div>
                    </div>
                `;
            
            case 'split':
                return `
                    <h3 class="text-lg font-bold mb-4">Split Options</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm text-gray-300 mb-2">Split method</label>
                            <select id="splitMethod" class="input-field">
                                <option value="pages">By page range</option>
                                <option value="every">Every N pages</option>
                                <option value="size">By file size</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm text-gray-300 mb-2">Page range (e.g., 1-5, 10-15)</label>
                            <input type="text" id="pageRange" placeholder="1-10" class="input-field">
                        </div>
                    </div>
                `;
            
            case 'compress':
                return `
                    <h3 class="text-lg font-bold mb-4">Compression Options</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm text-gray-300 mb-2">Compression level</label>
                            <select id="compressionLevel" class="input-field">
                                <option value="low">Low (better quality)</option>
                                <option value="medium" selected>Medium (balanced)</option>
                                <option value="high">High (smaller size)</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm text-gray-300 mb-2">Target size (optional)</label>
                            <input type="number" id="targetSize" placeholder="Size in MB" class="input-field">
                        </div>
                    </div>
                `;
            
            case 'watermark':
                return `
                    <h3 class="text-lg font-bold mb-4">Watermark Options</h3>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm text-gray-300 mb-2">Watermark text</label>
                            <input type="text" id="watermarkText" placeholder="CONFIDENTIAL" class="input-field">
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div>
                                <label class="block text-sm text-gray-300 mb-2">Position</label>
                                <select id="watermarkPosition" class="input-field">
                                    <option value="center">Center</option>
                                    <option value="top-left">Top Left</option>
                                    <option value="top-right">Top Right</option>
                                    <option value="bottom-left">Bottom Left</option>
                                    <option value="bottom-right">Bottom Right</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm text-gray-300 mb-2">Opacity</label>
                                <input type="range" id="watermarkOpacity" min="10" max="100" value="50" class="w-full">
                                <div class="text-center text-sm text-gray-400 mt-1">
                                    <span id="opacityValue">50</span>%
                                </div>
                            </div>
                            <div>
                                <label class="block text-sm text-gray-300 mb-2">Color</label>
                                <input type="color" id="watermarkColor" value="#ff0000" class="input-field h-10">
                            </div>
                        </div>
                    </div>
                `;
            
            default:
                return '<p class="text-gray-400">No additional options for this tool.</p>';
        }
    }

    processFiles() {
        if (this.selectedFiles.length === 0) {
            ToolAPI.showError('Please select files first');
            return;
        }

        // Show loading state
        const processBtn = document.getElementById('processFiles');
        processBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Processing...';
        processBtn.disabled = true;

        // Simulate processing (in a real app, this would call backend APIs)
        setTimeout(() => {
            this.showResults();
            processBtn.innerHTML = '<i class="fas fa-cog mr-2"></i>Process Files';
            processBtn.disabled = false;
        }, 2000);
    }

    showResults() {
        const resultsSection = document.getElementById('resultsSection');
        const resultsContainer = document.getElementById('resultsContainer');
        
        resultsSection.classList.remove('hidden');
        
        // Generate mock results based on tool
        const results = this.generateMockResults();
        
        resultsContainer.innerHTML = results.map(result => `
            <div class="flex items-center justify-between p-4 bg-dark/30 rounded-lg mb-3">
                <div class="flex items-center space-x-3">
                    <i class="fas fa-file-pdf text-green-400 text-2xl"></i>
                    <div>
                        <div class="font-semibold text-white">${result.name}</div>
                        <div class="text-sm text-gray-400">${result.size} • ${result.status}</div>
                    </div>
                </div>
                <button class="btn-primary" onclick="downloadFile('${result.name}')">
                    <i class="fas fa-download mr-2"></i>
                    Download
                </button>
            </div>
        `).join('');
        
        ToolAPI.showSuccess('Files processed successfully!');
    }

    generateMockResults() {
        switch (this.currentTool) {
            case 'merge':
                return [{
                    name: document.getElementById('outputName')?.value || 'merged-document.pdf',
                    size: '2.4 MB',
                    status: 'Merged successfully'
                }];
            
            case 'split':
                return [
                    { name: 'document-pages-1-5.pdf', size: '856 KB', status: 'Split successfully' },
                    { name: 'document-pages-6-10.pdf', size: '1.2 MB', status: 'Split successfully' }
                ];
            
            case 'compress':
                return this.selectedFiles.map(file => ({
                    name: file.name.replace('.pdf', '-compressed.pdf'),
                    size: Math.round(file.size * 0.6 / 1024 / 1024 * 100) / 100 + ' MB',
                    status: 'Compressed (40% reduction)'
                }));
            
            default:
                return this.selectedFiles.map(file => ({
                    name: file.name.replace(/\.[^/.]+$/, '') + '-processed.pdf',
                    size: '1.2 MB',
                    status: 'Processed successfully'
                }));
        }
    }

    formatFileSize(bytes) {
        if (bytes === 0) return '0 Bytes';
        const k = 1024;
        const sizes = ['Bytes', 'KB', 'MB', 'GB'];
        const i = Math.floor(Math.log(bytes) / Math.log(k));
        return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
    }
}

// Global functions
function removeFile(index) {
    if (window.pdfToolkit) {
        window.pdfToolkit.selectedFiles.splice(index, 1);
        window.pdfToolkit.displayFileList();
        
        if (window.pdfToolkit.selectedFiles.length === 0) {
            document.getElementById('toolOptions').classList.add('hidden');
            document.getElementById('processSection').classList.add('hidden');
        }
    }
}

function downloadFile(filename) {
    // In a real app, this would download the actual processed file
    ToolAPI.showSuccess(`Downloading ${filename}...`);
}

// Initialize PDF toolkit
document.addEventListener('DOMContentLoaded', () => {
    window.pdfToolkit = new PDFToolkit();
    
    // Update opacity display for watermark
    document.addEventListener('input', (e) => {
        if (e.target.id === 'watermarkOpacity') {
            document.getElementById('opacityValue').textContent = e.target.value;
        }
    });
});
</script>
{% endblock %}
