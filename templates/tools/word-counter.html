{% extends "base.html" %}

{% block title %}Word Counter - DiskTools{% endblock %}

{% block content %}
<div class="container mx-auto px-6 py-12">
    <!-- Header -->
    <div class="text-center mb-12">
        <div class="inline-block p-4 bg-gradient-to-r from-primary to-secondary rounded-full mb-6">
            <i class="fas fa-sort-numeric-up text-4xl text-white"></i>
        </div>
        <h1 class="text-4xl font-bold mb-4 text-gradient">Word Counter</h1>
        <p class="text-xl text-gray-300">Analyze text with detailed statistics and reading time</p>
    </div>

    <!-- Word Counter Interface -->
    <div class="max-w-6xl mx-auto">
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- Text Input Area -->
            <div class="lg:col-span-2">
                <div class="glass rounded-2xl p-6">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-2xl font-bold flex items-center">
                            <i class="fas fa-edit text-primary mr-3"></i>
                            Text Editor
                        </h2>
                        <div class="flex space-x-2">
                            <button id="clearText" class="btn-secondary text-sm">
                                <i class="fas fa-trash mr-1"></i>
                                Clear
                            </button>
                            <button id="pasteText" class="btn-secondary text-sm">
                                <i class="fas fa-paste mr-1"></i>
                                Paste
                            </button>
                            <button id="loadFile" class="btn-secondary text-sm">
                                <i class="fas fa-file-upload mr-1"></i>
                                Load File
                            </button>
                        </div>
                    </div>
                    
                    <textarea 
                        id="textInput" 
                        placeholder="Type or paste your text here to analyze..."
                        class="w-full h-96 p-4 bg-dark/50 border border-white/20 rounded-xl text-white placeholder-gray-400 resize-none focus:outline-none focus:border-primary/50 focus:ring-2 focus:ring-primary/20 transition-all"
                    ></textarea>
                    
                    <!-- Quick Actions -->
                    <div class="mt-4 flex flex-wrap gap-2">
                        <button id="sampleText" class="btn-secondary text-sm">
                            <i class="fas fa-magic mr-1"></i>
                            Load Sample
                        </button>
                        <button id="exportText" class="btn-secondary text-sm">
                            <i class="fas fa-download mr-1"></i>
                            Export
                        </button>
                        <button id="copyStats" class="btn-secondary text-sm">
                            <i class="fas fa-copy mr-1"></i>
                            Copy Stats
                        </button>
                    </div>
                </div>
                
                <!-- Advanced Analysis -->
                <div class="glass rounded-2xl p-6 mt-6">
                    <h3 class="text-xl font-bold mb-4 flex items-center">
                        <i class="fas fa-chart-bar text-primary mr-3"></i>
                        Advanced Analysis
                    </h3>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- Most Common Words -->
                        <div>
                            <h4 class="font-semibold mb-3">Most Common Words</h4>
                            <div id="commonWords" class="space-y-2 max-h-48 overflow-y-auto">
                                <p class="text-gray-400 text-sm">Enter text to see analysis</p>
                            </div>
                        </div>
                        
                        <!-- Readability Scores -->
                        <div>
                            <h4 class="font-semibold mb-3">Readability Analysis</h4>
                            <div id="readabilityScores" class="space-y-2">
                                <div class="flex justify-between">
                                    <span class="text-gray-300">Reading Level:</span>
                                    <span id="readingLevel" class="font-bold text-primary">-</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-300">Complexity:</span>
                                    <span id="complexity" class="font-bold text-secondary">-</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-300">Avg Sentence Length:</span>
                                    <span id="avgSentenceLength" class="font-bold text-accent">-</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Statistics Panel -->
            <div class="space-y-6">
                <!-- Basic Statistics -->
                <div class="glass rounded-2xl p-6">
                    <h3 class="text-xl font-bold mb-4 flex items-center">
                        <i class="fas fa-calculator text-primary mr-3"></i>
                        Statistics
                    </h3>
                    
                    <div class="space-y-4">
                        <div class="text-center">
                            <div class="text-4xl font-bold text-gradient mb-2" id="wordCount">0</div>
                            <p class="text-gray-400">Words</p>
                        </div>
                        
                        <div class="grid grid-cols-2 gap-3 text-center">
                            <div class="bg-dark/30 rounded-lg p-3">
                                <div class="text-xl font-bold text-blue-400" id="charCount">0</div>
                                <div class="text-xs text-gray-400">Characters</div>
                            </div>
                            <div class="bg-dark/30 rounded-lg p-3">
                                <div class="text-xl font-bold text-green-400" id="charCountNoSpaces">0</div>
                                <div class="text-xs text-gray-400">No Spaces</div>
                            </div>
                            <div class="bg-dark/30 rounded-lg p-3">
                                <div class="text-xl font-bold text-yellow-400" id="sentenceCount">0</div>
                                <div class="text-xs text-gray-400">Sentences</div>
                            </div>
                            <div class="bg-dark/30 rounded-lg p-3">
                                <div class="text-xl font-bold text-purple-400" id="paragraphCount">0</div>
                                <div class="text-xs text-gray-400">Paragraphs</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Reading Time -->
                <div class="glass rounded-2xl p-6">
                    <h3 class="text-xl font-bold mb-4 flex items-center">
                        <i class="fas fa-clock text-primary mr-3"></i>
                        Reading Time
                    </h3>
                    
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-gray-300">Slow (150 WPM):</span>
                            <span id="readingTimeSlow" class="font-bold text-red-400">0m 0s</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-300">Average (250 WPM):</span>
                            <span id="readingTimeAverage" class="font-bold text-yellow-400">0m 0s</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-300">Fast (350 WPM):</span>
                            <span id="readingTimeFast" class="font-bold text-green-400">0m 0s</span>
                        </div>
                        
                        <div class="mt-4 p-3 bg-primary/20 rounded-lg">
                            <div class="text-center">
                                <div class="text-2xl font-bold text-primary" id="speakingTime">0m 0s</div>
                                <div class="text-sm text-gray-300">Speaking Time (130 WPM)</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Text Density -->
                <div class="glass rounded-2xl p-6">
                    <h3 class="text-xl font-bold mb-4 flex items-center">
                        <i class="fas fa-layer-group text-primary mr-3"></i>
                        Text Density
                    </h3>
                    
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-gray-300">Avg Words/Sentence:</span>
                            <span id="avgWordsPerSentence" class="font-bold text-primary">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-300">Avg Chars/Word:</span>
                            <span id="avgCharsPerWord" class="font-bold text-secondary">0</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-300">Longest Word:</span>
                            <span id="longestWord" class="font-bold text-accent">-</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-300">Unique Words:</span>
                            <span id="uniqueWords" class="font-bold text-green-400">0</span>
                        </div>
                    </div>
                </div>
                
                <!-- Export Options -->
                <div class="glass rounded-2xl p-6">
                    <h3 class="text-xl font-bold mb-4 flex items-center">
                        <i class="fas fa-share-alt text-primary mr-3"></i>
                        Export & Share
                    </h3>
                    
                    <div class="space-y-3">
                        <button id="exportPDF" class="w-full btn-secondary">
                            <i class="fas fa-file-pdf mr-2"></i>
                            Export as PDF
                        </button>
                        <button id="exportCSV" class="w-full btn-secondary">
                            <i class="fas fa-file-csv mr-2"></i>
                            Export as CSV
                        </button>
                        <button id="shareStats" class="w-full btn-secondary">
                            <i class="fas fa-share mr-2"></i>
                            Share Statistics
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- File Input -->
<input type="file" id="fileInput" accept=".txt,.doc,.docx" class="hidden">
{% endblock %}

{% block extra_scripts %}
<script>
class WordCounter {
    constructor() {
        this.textInput = document.getElementById('textInput');
        this.init();
    }

    init() {
        this.setupEventListeners();
        this.updateStats();
    }

    setupEventListeners() {
        // Real-time text analysis
        this.textInput.addEventListener('input', () => this.updateStats());
        this.textInput.addEventListener('paste', () => {
            setTimeout(() => this.updateStats(), 100);
        });

        // Button actions
        document.getElementById('clearText').addEventListener('click', () => this.clearText());
        document.getElementById('pasteText').addEventListener('click', () => this.pasteFromClipboard());
        document.getElementById('loadFile').addEventListener('click', () => this.loadFile());
        document.getElementById('sampleText').addEventListener('click', () => this.loadSampleText());
        document.getElementById('exportText').addEventListener('click', () => this.exportText());
        document.getElementById('copyStats').addEventListener('click', () => this.copyStats());
        document.getElementById('exportPDF').addEventListener('click', () => this.exportPDF());
        document.getElementById('exportCSV').addEventListener('click', () => this.exportCSV());
        document.getElementById('shareStats').addEventListener('click', () => this.shareStats());

        // File input
        document.getElementById('fileInput').addEventListener('change', (e) => this.handleFileLoad(e));
    }

    updateStats() {
        const text = this.textInput.value;
        
        // Basic counts
        const words = this.countWords(text);
        const characters = text.length;
        const charactersNoSpaces = text.replace(/\s/g, '').length;
        const sentences = this.countSentences(text);
        const paragraphs = this.countParagraphs(text);

        // Update basic stats
        document.getElementById('wordCount').textContent = words;
        document.getElementById('charCount').textContent = characters;
        document.getElementById('charCountNoSpaces').textContent = charactersNoSpaces;
        document.getElementById('sentenceCount').textContent = sentences;
        document.getElementById('paragraphCount').textContent = paragraphs;

        // Reading times
        this.updateReadingTimes(words);

        // Text density
        this.updateTextDensity(text, words, sentences, characters);

        // Advanced analysis
        this.updateAdvancedAnalysis(text);
    }

    countWords(text) {
        if (!text.trim()) return 0;
        return text.trim().split(/\s+/).filter(word => word.length > 0).length;
    }

    countSentences(text) {
        if (!text.trim()) return 0;
        return text.split(/[.!?]+/).filter(sentence => sentence.trim().length > 0).length;
    }

    countParagraphs(text) {
        if (!text.trim()) return 0;
        return text.split(/\n\s*\n/).filter(paragraph => paragraph.trim().length > 0).length;
    }

    updateReadingTimes(words) {
        const slowTime = this.formatTime(words / 150);
        const averageTime = this.formatTime(words / 250);
        const fastTime = this.formatTime(words / 350);
        const speakingTime = this.formatTime(words / 130);

        document.getElementById('readingTimeSlow').textContent = slowTime;
        document.getElementById('readingTimeAverage').textContent = averageTime;
        document.getElementById('readingTimeFast').textContent = fastTime;
        document.getElementById('speakingTime').textContent = speakingTime;
    }

    formatTime(minutes) {
        if (minutes < 1) return '0m 0s';
        const mins = Math.floor(minutes);
        const secs = Math.round((minutes - mins) * 60);
        return `${mins}m ${secs}s`;
    }

    updateTextDensity(text, words, sentences, characters) {
        const avgWordsPerSentence = sentences > 0 ? Math.round(words / sentences * 10) / 10 : 0;
        const avgCharsPerWord = words > 0 ? Math.round(characters / words * 10) / 10 : 0;
        
        const wordArray = text.trim().split(/\s+/).filter(word => word.length > 0);
        const longestWord = wordArray.reduce((longest, current) => 
            current.length > longest.length ? current : longest, '');
        
        const uniqueWords = new Set(wordArray.map(word => word.toLowerCase().replace(/[^\w]/g, ''))).size;

        document.getElementById('avgWordsPerSentence').textContent = avgWordsPerSentence;
        document.getElementById('avgCharsPerWord').textContent = avgCharsPerWord;
        document.getElementById('longestWord').textContent = longestWord || '-';
        document.getElementById('uniqueWords').textContent = uniqueWords;
    }

    updateAdvancedAnalysis(text) {
        this.updateCommonWords(text);
        this.updateReadabilityScores(text);
    }

    updateCommonWords(text) {
        const container = document.getElementById('commonWords');
        
        if (!text.trim()) {
            container.innerHTML = '<p class="text-gray-400 text-sm">Enter text to see analysis</p>';
            return;
        }

        const words = text.toLowerCase()
            .replace(/[^\w\s]/g, '')
            .split(/\s+/)
            .filter(word => word.length > 2);

        const wordCount = {};
        words.forEach(word => {
            wordCount[word] = (wordCount[word] || 0) + 1;
        });

        const sortedWords = Object.entries(wordCount)
            .sort(([,a], [,b]) => b - a)
            .slice(0, 10);

        container.innerHTML = sortedWords.map(([word, count]) => `
            <div class="flex justify-between items-center p-2 bg-dark/30 rounded text-sm">
                <span class="text-white">${word}</span>
                <span class="text-primary font-bold">${count}</span>
            </div>
        `).join('');
    }

    updateReadabilityScores(text) {
        const sentences = this.countSentences(text);
        const words = this.countWords(text);
        const avgSentenceLength = sentences > 0 ? Math.round(words / sentences * 10) / 10 : 0;

        // Simple readability assessment
        let readingLevel = 'Elementary';
        let complexity = 'Simple';

        if (avgSentenceLength > 20) {
            readingLevel = 'College';
            complexity = 'Complex';
        } else if (avgSentenceLength > 15) {
            readingLevel = 'High School';
            complexity = 'Moderate';
        } else if (avgSentenceLength > 10) {
            readingLevel = 'Middle School';
            complexity = 'Simple';
        }

        document.getElementById('readingLevel').textContent = readingLevel;
        document.getElementById('complexity').textContent = complexity;
        document.getElementById('avgSentenceLength').textContent = avgSentenceLength;
    }

    clearText() {
        this.textInput.value = '';
        this.updateStats();
        ToolAPI.showSuccess('Text cleared');
    }

    async pasteFromClipboard() {
        try {
            const text = await navigator.clipboard.readText();
            this.textInput.value = text;
            this.updateStats();
            ToolAPI.showSuccess('Text pasted from clipboard');
        } catch (err) {
            ToolAPI.showError('Could not access clipboard');
        }
    }

    loadFile() {
        document.getElementById('fileInput').click();
    }

    handleFileLoad(event) {
        const file = event.target.files[0];
        if (!file) return;

        const reader = new FileReader();
        reader.onload = (e) => {
            this.textInput.value = e.target.result;
            this.updateStats();
            ToolAPI.showSuccess(`File "${file.name}" loaded successfully`);
        };
        reader.readAsText(file);
    }

    loadSampleText() {
        const sampleTexts = [
            "Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.",
            
            "The quick brown fox jumps over the lazy dog. This pangram contains every letter of the alphabet at least once. It's commonly used for testing fonts, keyboards, and other applications that need to display or process text. The sentence is concise yet comprehensive, making it perfect for various testing purposes.",
            
            "In the digital age, technology has revolutionized how we communicate, work, and live. From smartphones to artificial intelligence, innovations continue to shape our daily experiences. Social media platforms connect people across the globe, while cloud computing enables seamless collaboration. As we advance into the future, emerging technologies like quantum computing and biotechnology promise to unlock new possibilities for human progress."
        ];
        
        const randomText = sampleTexts[Math.floor(Math.random() * sampleTexts.length)];
        this.textInput.value = randomText;
        this.updateStats();
        ToolAPI.showSuccess('Sample text loaded');
    }

    exportText() {
        const text = this.textInput.value;
        if (!text.trim()) {
            ToolAPI.showError('No text to export');
            return;
        }

        const blob = new Blob([text], { type: 'text/plain' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'text-analysis.txt';
        a.click();
        URL.revokeObjectURL(url);
        
        ToolAPI.showSuccess('Text exported successfully');
    }

    copyStats() {
        const stats = this.generateStatsText();
        
        navigator.clipboard.writeText(stats).then(() => {
            ToolAPI.showSuccess('Statistics copied to clipboard');
        }).catch(() => {
            ToolAPI.showError('Could not copy to clipboard');
        });
    }

    generateStatsText() {
        return `Text Analysis Results:
Words: ${document.getElementById('wordCount').textContent}
Characters: ${document.getElementById('charCount').textContent}
Characters (no spaces): ${document.getElementById('charCountNoSpaces').textContent}
Sentences: ${document.getElementById('sentenceCount').textContent}
Paragraphs: ${document.getElementById('paragraphCount').textContent}
Reading Time (average): ${document.getElementById('readingTimeAverage').textContent}
Speaking Time: ${document.getElementById('speakingTime').textContent}
Reading Level: ${document.getElementById('readingLevel').textContent}
Complexity: ${document.getElementById('complexity').textContent}`;
    }

    exportPDF() {
        ToolAPI.showSuccess('PDF export feature coming soon!');
    }

    exportCSV() {
        const csvData = [
            ['Metric', 'Value'],
            ['Words', document.getElementById('wordCount').textContent],
            ['Characters', document.getElementById('charCount').textContent],
            ['Characters (no spaces)', document.getElementById('charCountNoSpaces').textContent],
            ['Sentences', document.getElementById('sentenceCount').textContent],
            ['Paragraphs', document.getElementById('paragraphCount').textContent],
            ['Reading Time (average)', document.getElementById('readingTimeAverage').textContent],
            ['Speaking Time', document.getElementById('speakingTime').textContent],
            ['Reading Level', document.getElementById('readingLevel').textContent],
            ['Complexity', document.getElementById('complexity').textContent]
        ];

        const csvContent = csvData.map(row => row.join(',')).join('\n');
        const blob = new Blob([csvContent], { type: 'text/csv' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'text-statistics.csv';
        a.click();
        URL.revokeObjectURL(url);
        
        ToolAPI.showSuccess('Statistics exported as CSV');
    }

    shareStats() {
        const stats = this.generateStatsText();
        
        if (navigator.share) {
            navigator.share({
                title: 'Text Analysis Results',
                text: stats
            });
        } else {
            this.copyStats();
        }
    }
}

// Initialize word counter
document.addEventListener('DOMContentLoaded', () => {
    new WordCounter();
});
</script>
{% endblock %}
